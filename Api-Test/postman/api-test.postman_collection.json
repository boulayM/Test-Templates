{
  "info": {
    "_postman_id": "9c3b8f8a-0000-0000-0000-000000000000",
    "name": "Api-Test Collection",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "00 Setup",
      "item": [
        {
          "name": "Get CSRF",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/csrf"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const data = pm.response.json();",
                  "if (data && data.csrfToken) {",
                  "  pm.collectionVariables.set('csrfToken', data.csrfToken);",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Login Admin",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": "{{baseUrl}}/api/auth/login",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{adminEmail}}\",\n  \"password\": \"{{adminPassword}}\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const data = pm.response.json();",
                  "if (data && data.user && data.user.id) {",
                  "  pm.collectionVariables.set('adminId', data.user.id);",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Login User",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": "{{baseUrl}}/api/auth/login",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{userEmail}}\",\n  \"password\": \"{{userPassword}}\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const data = pm.response.json();",
                  "if (data && data.user && data.user.id) {",
                  "  pm.collectionVariables.set('userId', data.user.id);",
                  "}"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Auth",
      "item": [
        {
          "name": "Auth Me",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/auth/me"
          }
        },
        {
          "name": "Auth Register (captcha optional)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": "{{baseUrl}}/api/auth/register",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"firstName\": \"John\",\n  \"lastName\": \"Doe\",\n  \"email\": \"{{newUserEmail}}\",\n  \"password\": \"User123!\",\n  \"captchaToken\": \"{{captchaToken}}\"\n}"
            }
          }
        },
        {
          "name": "Auth Verify Email",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/auth/verify-email?token={{verifyToken}}"
          }
        },
        {
          "name": "Auth Refresh",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/api/auth/refresh"
          }
        },
        {
          "name": "Auth Logout",
          "request": {
            "method": "POST",
            "header": [
              { "key": "x-csrf-token", "value": "{{csrfToken}}" }
            ],
            "url": "{{baseUrl}}/api/auth/logout"
          }
        }
      ]
    },
    {
      "name": "Users",
      "item": [
        {
          "name": "Admin Create User",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": "{{baseUrl}}/api/users/register",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"firstName\": \"Alice\",\n  \"lastName\": \"Martin\",\n  \"email\": \"{{createdUserEmail}}\",\n  \"password\": \"User123!\",\n  \"role\": \"USER\",\n  \"emailVerified\": true\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const data = pm.response.json();",
                  "if (data && data.user && data.user.id) {",
                  "  pm.collectionVariables.set('createdUserId', data.user.id);",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Get Users",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/users"
          }
        },
        {
          "name": "Update User",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "x-csrf-token", "value": "{{csrfToken}}" }
            ],
            "url": "{{baseUrl}}/api/users/{{createdUserId}}",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"firstName\": \"Alice2\",\n  \"emailVerified\": true\n}"
            }
          }
        },
        {
          "name": "Delete User",
          "request": {
            "method": "DELETE",
            "header": [
              { "key": "x-csrf-token", "value": "{{csrfToken}}" }
            ],
            "url": "{{baseUrl}}/api/users/{{createdUserId}}"
          }
        }
      ]
    },
    {
      "name": "Categories",
      "item": [
        {
          "name": "Create Category",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "x-csrf-token", "value": "{{csrfToken}}" }
            ],
            "url": "{{baseUrl}}/api/categories",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Electronics\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const data = pm.response.json();",
                  "if (data && data.id) {",
                  "  pm.collectionVariables.set('categoryId', data.id);",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Get Categories",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/categories"
          }
        },
        {
          "name": "Update Category",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "x-csrf-token", "value": "{{csrfToken}}" }
            ],
            "url": "{{baseUrl}}/api/categories/{{categoryId}}",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Electronics Updated\"\n}"
            }
          }
        },
        {
          "name": "Delete Category",
          "request": {
            "method": "DELETE",
            "header": [
              { "key": "x-csrf-token", "value": "{{csrfToken}}" }
            ],
            "url": "{{baseUrl}}/api/categories/{{categoryId}}"
          }
        }
      ]
    },
    {
      "name": "Products",
      "item": [
        {
          "name": "Create Product",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "x-csrf-token", "value": "{{csrfToken}}" }
            ],
            "url": "{{baseUrl}}/api/products",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Product A\",\n  \"description\": \"Sample product\",\n  \"priceCents\": 1999,\n  \"currency\": \"EUR\",\n  \"sku\": \"SKU-001\",\n  \"isActive\": true,\n  \"categoryIds\": [{{categoryId}}],\n  \"images\": [\n    {\"url\": \"https://picsum.photos/seed/p1/800/600\", \"alt\": \"img1\", \"position\": 1}\n  ]\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const data = pm.response.json();",
                  "if (data && data.id) {",
                  "  pm.collectionVariables.set('productId', data.id);",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Get Products",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/products"
          }
        },
        {
          "name": "Get Product",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/products/{{productId}}"
          }
        },
        {
          "name": "Update Product",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "x-csrf-token", "value": "{{csrfToken}}" }
            ],
            "url": "{{baseUrl}}/api/products/{{productId}}",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Product A2\",\n  \"priceCents\": 2999\n}"
            }
          }
        },
        {
          "name": "Delete Product",
          "request": {
            "method": "DELETE",
            "header": [
              { "key": "x-csrf-token", "value": "{{csrfToken}}" }
            ],
            "url": "{{baseUrl}}/api/products/{{productId}}"
          }
        }
      ]
    },
    {
      "name": "Addresses",
      "item": [
        {
          "name": "Create Address",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "x-csrf-token", "value": "{{csrfToken}}" }
            ],
            "url": "{{baseUrl}}/api/addresses",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"label\": \"Home\",\n  \"fullName\": \"John Doe\",\n  \"phone\": \"0102030405\",\n  \"line1\": \"1 Main St\",\n  \"line2\": null,\n  \"postalCode\": \"75001\",\n  \"city\": \"Paris\",\n  \"country\": \"FR\",\n  \"isDefault\": true\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const data = pm.response.json();",
                  "if (data && data.id) {",
                  "  pm.collectionVariables.set('addressId', data.id);",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Get Addresses",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/addresses"
          }
        },
        {
          "name": "Update Address",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "x-csrf-token", "value": "{{csrfToken}}" }
            ],
            "url": "{{baseUrl}}/api/addresses/{{addressId}}",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"city\": \"Lyon\"\n}"
            }
          }
        },
        {
          "name": "Delete Address",
          "request": {
            "method": "DELETE",
            "header": [
              { "key": "x-csrf-token", "value": "{{csrfToken}}" }
            ],
            "url": "{{baseUrl}}/api/addresses/{{addressId}}"
          }
        }
      ]
    },
    {
      "name": "Cart",
      "item": [
        {
          "name": "Get My Cart",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/carts"
          }
        },
        {
          "name": "Add Item",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "x-csrf-token", "value": "{{csrfToken}}" }
            ],
            "url": "{{baseUrl}}/api/carts/items",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"productId\": {{productId}},\n  \"quantity\": 1\n}"
            }
          }
        },
        {
          "name": "Update Item",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "x-csrf-token", "value": "{{csrfToken}}" }
            ],
            "url": "{{baseUrl}}/api/carts/items/{{productId}}",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"quantity\": 2\n}"
            }
          }
        },
        {
          "name": "Remove Item",
          "request": {
            "method": "DELETE",
            "header": [
              { "key": "x-csrf-token", "value": "{{csrfToken}}" }
            ],
            "url": "{{baseUrl}}/api/carts/items/{{productId}}"
          }
        },
        {
          "name": "Update Cart Status",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "x-csrf-token", "value": "{{csrfToken}}" }
            ],
            "url": "{{baseUrl}}/api/carts/status",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"ABANDONED\"\n}"
            }
          }
        }
      ]
    },
    {
      "name": "Orders",
      "item": [
        {
          "name": "Create Order",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "x-csrf-token", "value": "{{csrfToken}}" }
            ],
            "url": "{{baseUrl}}/api/orders",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"items\": [\n    {\"productId\": {{productId}}, \"quantity\": 1}\n  ],\n  \"shippingAddressId\": {{addressId}},\n  \"billingAddressId\": {{addressId}},\n  \"currency\": \"EUR\",\n  \"shippingCents\": 500,\n  \"discountCents\": 0\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const data = pm.response.json();",
                  "if (data && data.id) {",
                  "  pm.collectionVariables.set('orderId', data.id);",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Get Orders",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/orders"
          }
        },
        {
          "name": "Get Order",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/orders/{{orderId}}"
          }
        },
        {
          "name": "Update Order Status",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "x-csrf-token", "value": "{{csrfToken}}" }
            ],
            "url": "{{baseUrl}}/api/orders/{{orderId}}/status",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"PAID\"\n}"
            }
          }
        },
        {
          "name": "Add Item To Order",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "x-csrf-token", "value": "{{csrfToken}}" }
            ],
            "url": "{{baseUrl}}/api/orders/{{orderId}}/items",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"productId\": {{productId}},\n  \"quantity\": 1\n}"
            }
          }
        },
        {
          "name": "Remove Item From Order",
          "request": {
            "method": "DELETE",
            "header": [
              { "key": "x-csrf-token", "value": "{{csrfToken}}" }
            ],
            "url": "{{baseUrl}}/api/orders/{{orderId}}/items/{{productId}}"
          }
        },
        {
          "name": "Delete Order",
          "request": {
            "method": "DELETE",
            "header": [
              { "key": "x-csrf-token", "value": "{{csrfToken}}" }
            ],
            "url": "{{baseUrl}}/api/orders/{{orderId}}"
          }
        }
      ]
    },
    {
      "name": "Coupons",
      "item": [
        {
          "name": "Create Coupon",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "x-csrf-token", "value": "{{csrfToken}}" }
            ],
            "url": "{{baseUrl}}/api/coupons",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"code\": \"WELCOME10\",\n  \"type\": \"PERCENT\",\n  \"value\": 10,\n  \"isActive\": true\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const data = pm.response.json();",
                  "if (data && data.id) {",
                  "  pm.collectionVariables.set('couponId', data.id);",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Get Coupons",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/coupons"
          }
        },
        {
          "name": "Update Coupon",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "x-csrf-token", "value": "{{csrfToken}}" }
            ],
            "url": "{{baseUrl}}/api/coupons/{{couponId}}",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"value\": 15\n}"
            }
          }
        },
        {
          "name": "Delete Coupon",
          "request": {
            "method": "DELETE",
            "header": [
              { "key": "x-csrf-token", "value": "{{csrfToken}}" }
            ],
            "url": "{{baseUrl}}/api/coupons/{{couponId}}"
          }
        }
      ]
    },
    {
      "name": "Reviews",
      "item": [
        {
          "name": "Create Review",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "x-csrf-token", "value": "{{csrfToken}}" }
            ],
            "url": "{{baseUrl}}/api/reviews",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"productId\": {{productId}},\n  \"rating\": 5,\n  \"comment\": \"Great\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const data = pm.response.json();",
                  "if (data && data.id) {",
                  "  pm.collectionVariables.set('reviewId', data.id);",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Get Reviews",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/reviews"
          }
        },
        {
          "name": "Update Review",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "x-csrf-token", "value": "{{csrfToken}}" }
            ],
            "url": "{{baseUrl}}/api/reviews/{{reviewId}}",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"rating\": 4\n}"
            }
          }
        },
        {
          "name": "Delete Review",
          "request": {
            "method": "DELETE",
            "header": [
              { "key": "x-csrf-token", "value": "{{csrfToken}}" }
            ],
            "url": "{{baseUrl}}/api/reviews/{{reviewId}}"
          }
        }
      ]
    },
    {
      "name": "Payments",
      "item": [
        {
          "name": "Create Payment",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "x-csrf-token", "value": "{{csrfToken}}" }
            ],
            "url": "{{baseUrl}}/api/payments",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"orderId\": {{orderId}},\n  \"provider\": \"STRIPE\",\n  \"amountCents\": 1000,\n  \"currency\": \"EUR\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const data = pm.response.json();",
                  "if (data && data.id) {",
                  "  pm.collectionVariables.set('paymentId', data.id);",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Get Payments",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/payments"
          }
        },
        {
          "name": "Update Payment",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "x-csrf-token", "value": "{{csrfToken}}" }
            ],
            "url": "{{baseUrl}}/api/payments/{{paymentId}}",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"CAPTURED\"\n}"
            }
          }
        }
      ]
    },
    {
      "name": "Shipments",
      "item": [
        {
          "name": "Create Shipment",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "x-csrf-token", "value": "{{csrfToken}}" }
            ],
            "url": "{{baseUrl}}/api/shipments",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"orderId\": {{orderId}},\n  \"carrier\": \"DHL\",\n  \"trackingNumber\": \"TRACK123\",\n  \"status\": \"IN_TRANSIT\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const data = pm.response.json();",
                  "if (data && data.id) {",
                  "  pm.collectionVariables.set('shipmentId', data.id);",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Get Shipments",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/shipments"
          }
        },
        {
          "name": "Update Shipment",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "x-csrf-token", "value": "{{csrfToken}}" }
            ],
            "url": "{{baseUrl}}/api/shipments/{{shipmentId}}",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"DELIVERED\"\n}"
            }
          }
        }
      ]
    },
    {
      "name": "Admin",
      "item": [
        {
          "name": "Admin Metrics",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/admin/metrics"
          }
        },
        {
          "name": "Admin Users Export",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/admin/users/export"
          }
        },
        {
          "name": "Admin Products Export",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/admin/products/export"
          }
        },
        {
          "name": "Admin Orders Export",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/admin/orders/export"
          }
        },
        {
          "name": "Admin Audit Logs Export",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/admin/audit-logs/export"
          }
        }
      ]
    },
    {
      "name": "Audit Logs",
      "item": [
        {
          "name": "Get Audit Logs",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/audit-logs"
          }
        },
        {
          "name": "Get Audit Log By Id",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/audit-logs/{{auditLogId}}"
          }
        }
      ]
    }
  ],
  "variable": [
    { "key": "baseUrl", "value": "http://localhost:3000" },
    { "key": "adminEmail", "value": "admin@example.com" },
    { "key": "adminPassword", "value": "Admin123!" },
    { "key": "userEmail", "value": "alice@example.com" },
    { "key": "userPassword", "value": "User123!" },
    { "key": "newUserEmail", "value": "new.user@example.com" },
    { "key": "createdUserEmail", "value": "created.user@example.com" },
    { "key": "captchaToken", "value": "" },
    { "key": "verifyToken", "value": "" },
    { "key": "csrfToken", "value": "" },
    { "key": "adminId", "value": "" },
    { "key": "userId", "value": "" },
    { "key": "createdUserId", "value": "" },
    { "key": "categoryId", "value": "" },
    { "key": "productId", "value": "" },
    { "key": "addressId", "value": "" },
    { "key": "orderId", "value": "" },
    { "key": "couponId", "value": "" },
    { "key": "reviewId", "value": "" },
    { "key": "paymentId", "value": "" },
    { "key": "shipmentId", "value": "" },
    { "key": "auditLogId", "value": "" }
  ]
}