<section class="container-xxl px-3">
  <div class="dashboard-card">
    <h1 class="dashboard-title">Dashboard</h1>
    <p class="dashboard-subtitle">Overview of BackOffice data.</p>

    <div class="mt-3 grid grid-md-2 grid-lg-4">
      <div class="card kpi-card">
        <h2>Users</h2>
        <p class="kpi-value">{{ metrics.users }}</p>
      </div>
      <div class="card kpi-card">
        <h2>Orders</h2>
        <p class="kpi-value">{{ metrics.orders }}</p>
      </div>
      <div class="card kpi-card">
        <h2>Revenue</h2>
        <p class="kpi-value">{{ centsToEuros(metrics.revenueCents) }} EUR</p>
      </div>
      <div class="card kpi-card">
        <h2>Products</h2>
        <p class="kpi-value">{{ metrics.products }}</p>
      </div>
    </div>

    <div class="mt-3 grid grid-md-2">
      <div class="card">
        <h2>Users status</h2>
        <div class="metric-line">
          Verified: <strong>{{ usersMetrics.verified }}</strong>
        </div>
        <div class="metric-line">
          Unverified: <strong>{{ usersMetrics.unverified }}</strong>
        </div>
      </div>
      <div class="card">
        <h2>Products status</h2>
        <div class="metric-line">
          Active: <strong>{{ productsMetrics.active }}</strong>
        </div>
        <div class="metric-line">
          Inactive: <strong>{{ productsMetrics.inactive }}</strong>
        </div>
      </div>
    </div>

    <div class="mt-3 grid grid-md-2">
      <div class="card">
        <h2>Orders by status</h2>
        <table class="table table-striped table-hover align-middle">
          <thead>
            <tr>
              <th>Status</th>
              <th>Count</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let s of statusList">
              <td>{{ s.status }}</td>
              <td>{{ s.count }}</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="card">
        <h2>Audit logs</h2>
        <div class="metric-line">
          Total: <strong>{{ auditMetrics.total }}</strong>
        </div>
      </div>
    </div>

    <div class="mt-3 grid grid-md-2">
      <div class="card">
        <h2>Payments</h2>
        <div class="metric-line">
          Total: <strong>{{ paymentsMetrics.total }}</strong>
        </div>
        <div class="metric-line">
          Captured: <strong>{{ paymentsMetrics.byStatus['CAPTURED'] || 0 }}</strong>
        </div>
        <div class="metric-line">
          Failed: <strong>{{ paymentsMetrics.byStatus['FAILED'] || 0 }}</strong>
        </div>
        <div class="metric-line">
          Refunded: <strong>{{ paymentsMetrics.byStatus['REFUNDED'] || 0 }}</strong>
        </div>
      </div>
      <div class="card">
        <h2>Shipments</h2>
        <div class="metric-line">
          Total: <strong>{{ shipmentsMetrics.total }}</strong>
        </div>
        <div class="metric-line">
          Created: <strong>{{ shipmentsMetrics.byStatus['CREATED'] || 0 }}</strong>
        </div>
        <div class="metric-line">
          In transit: <strong>{{ shipmentsMetrics.byStatus['IN_TRANSIT'] || 0 }}</strong>
        </div>
        <div class="metric-line">
          Delivered: <strong>{{ shipmentsMetrics.byStatus['DELIVERED'] || 0 }}</strong>
        </div>
      </div>
    </div>

    <div class="mt-3 grid grid-md-2">
      <div class="card">
        <h2>Inventory risk</h2>
        <div class="metric-line">
          Total rows: <strong>{{ inventoryMetrics.total }}</strong>
        </div>
        <div class="metric-line">
          Out of stock: <strong>{{ inventoryMetrics.outOfStock }}</strong>
        </div>
        <div class="metric-line">
          Low stock: <strong>{{ inventoryMetrics.lowStock }}</strong>
        </div>
      </div>
      <div class="card">
        <h2>Coupons & reviews</h2>
        <div class="metric-line">
          Coupons active/inactive:
          <strong>{{ couponsMetrics.active }}</strong> /
          <strong>{{ couponsMetrics.inactive }}</strong>
        </div>
        <div class="metric-line">
          Coupon usage total: <strong>{{ couponsMetrics.usedCount }}</strong>
        </div>
        <div class="metric-line">
          Reviews total: <strong>{{ reviewsMetrics.total }}</strong>
        </div>
        <div class="metric-line">
          Avg rating: <strong>{{ reviewsMetrics.avgRating.toFixed(2) }}</strong>
        </div>
        <div class="metric-line">
          Low ratings (1-2): <strong>{{ reviewsMetrics.lowRatings }}</strong>
        </div>
      </div>
    </div>

    <div class="mt-3 card">
      <h2>Alerts</h2>
      <ul class="alerts" *ngIf="alerts.length">
        <li *ngFor="let a of alerts">{{ a }}</li>
      </ul>
      <p *ngIf="!alerts.length" class="muted">No alerts.</p>
    </div>

    <div class="mt-3 card">
      <h2>Quick actions</h2>
      <div class="mt-2 grid grid-md-2 grid-lg-4">
        <a class="btn btn-outline-secondary" routerLink="/admin/users">Manage users</a>
        <a class="btn btn-outline-secondary" routerLink="/admin/products">Manage products</a>
        <a class="btn btn-outline-secondary" routerLink="/admin/orders">Manage orders</a>
        <a class="btn btn-outline-secondary" routerLink="/admin/audit-logs">View audit logs</a>
      </div>
    </div>

    <div class="mt-3 grid grid-md-2">
      <div class="card">
        <h2>Recent orders</h2>
        <table class="table table-striped table-hover align-middle">
          <thead>
            <tr>
              <th>ID</th>
              <th>Status</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let o of recentOrders">
              <td>{{ o.id }}</td>
              <td>{{ o.status }}</td>
              <td>{{ centsToEuros(o.totalCents) }} EUR</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="card">
        <h2>Recent users</h2>
        <table class="table table-striped table-hover align-middle">
          <thead>
            <tr>
              <th>Email</th>
              <th>Role</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let u of recentUsers">
              <td>{{ u.email }}</td>
              <td>{{ u.role }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="mt-3 card">
      <h2>Recent audit logs</h2>
      <table class="table table-striped table-hover align-middle">
        <thead>
          <tr>
            <th>Action</th>
            <th>User</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let l of recentLogs">
            <td>{{ l.action }}</td>
            <td>{{ l.userEmail || l.userId }}</td>
            <td>{{ formatDate(l.createdAt) }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</section>
