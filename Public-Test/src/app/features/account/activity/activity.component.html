<!-- Message info pour USER -->
@if (auth.isLoggedIn() && !auth.isAdmin()) {
  <div class="ds-alert ds-alert-info activity-alert text-center">
    Pour ajouter des produits, ouvrez la page <strong>Catalogue</strong> puis cliquez sur "Ajouter au panier".
  </div>
}
<div class="activity-container">
  @for (activityRecord of activityRecords; track activityRecord) {
    <div class="card-ui activity-card">
      <div class="activity-header">
        <div>
          <strong>Panier #{{ activityRecord.id }}</strong>
          <span class="activity-status">({{ activityRecord.status }})</span>
        </div>
        <div>
          <!-- Bouton ajouter element -->
          <a
            class="btn-ui btn-primary btn-sm"
            [routerLink]="['/catalog']"
            [queryParams]="{ includeActivityId: activityRecord.id }"
          >
            Ajouter produit
          </a>
          <!-- Bouton supprimer l activite -->
          <button
            class="btn-ui btn-secondary btn-sm"
            (click)="deleteActivityRecord(activityRecord.id)"
          >
            Vider le panier
          </button>
        </div>
      </div>
      <div class="activity-body">
        <table class="table-ui table-compact">
          <thead>
            <tr>
              <th>Produit</th>
              <th>Quantite</th>
              <th>Prix unitaire</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            @for (item of activityRecord.items; track item) {
              <tr>
                <td>{{ item.contentItem.name }}</td>
                <td>
                  <input
                    type="number"
                    min="1"
                    [(ngModel)]="item.quantity"
                    (change)="updateQuantity(activityRecord, item)"
                    class="form-control input-qty"
                  />
                </td>
                <td>{{ item.price | currency: "EUR" }}</td>
                <td>
                  <button
                    class="btn-ui btn-danger btn-sm"
                    (click)="removeItem(activityRecord.id, item.contentItemId)"
                  >
                    Retirer
                  </button>
                </td>
              </tr>
            }
          </tbody>
        </table>
        <div class="activity-total">
          <strong>Total estime: {{ getTotal(activityRecord) | currency: "EUR" }}</strong>
        </div>
        <div class="activity-coupon">
          <input type="text" [(ngModel)]="couponCode" placeholder="Code promo" />
          <button class="btn-ui btn-secondary btn-sm" (click)="applyCoupon(activityRecord)">
            Appliquer
          </button>
          @if (couponValid) {
            <span class="text-success">Coupon applique au checkout</span>
          }
        </div>
        <div class="activity-actions">
          <button class="btn-ui btn-primary" (click)="goCheckout()">Commander</button>
        </div>
      </div>
    </div>
  }
</div>
