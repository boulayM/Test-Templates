<section class="container py-4 d-grid gap-3">
  @if (loading) {
    <p>Chargement...</p>
  } @else if (!product) {
    <div class="alert alert-warning">Produit introuvable.</div>
  } @else {
    <div class="card">
      <h2>{{ product.name }}</h2>
      <p>{{ product.description }}</p>
      <p><strong>{{ product.price | currency: 'EUR' }}</strong></p>
    </div>

    @if (auth.isLoggedIn()) {
      <div class="card">
        <h3>Laisser un avis</h3>
        <label class="form-label">Note (1-5)</label>
        <input class="form-control mb-2" type="number" min="1" max="5" [(ngModel)]="rating" />
        <label class="form-label">Commentaire</label>
        <textarea class="form-control mb-2" rows="3" [(ngModel)]="comment"></textarea>
        <button class="btn btn-primary btn-sm" (click)="submitReview()">Publier</button>
      </div>
    }

    <div class="card">
      <h3>Avis</h3>
      @if (reviews.length === 0) {
        <p>Aucun avis.</p>
      } @else {
        <ul>
          @for (review of reviews; track review.id) {
            <li>
              <strong>{{ review.rating }}/5</strong> - {{ review.comment || 'Sans commentaire' }}
              @if (canDeleteReview(review)) {
                <button class="btn btn-danger btn-sm" (click)="deleteReview(review.id)">Supprimer</button>
              }
            </li>
          }
        </ul>
      }
    </div>
  }
</section>
